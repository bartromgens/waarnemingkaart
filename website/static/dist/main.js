!function(e){function t(r){if(o[r])return o[r].exports;var n=o[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,t),n.l=!0,n.exports}var o={};t.m=e,t.c=o,t.d=function(e,o,r){t.o(e,o)||Object.defineProperty(e,o,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var o=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(o,"a",o),o},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t,o){e.exports=o(1)},function(e,t,o){function r(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var o=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)"),r=o.exec(t);return r?r[2]?decodeURIComponent(r[2].replace(/\+/g," ")):"":null}function n(e){if(e.dragging)return void $("#info").hide();!function(e){var t=$("#info");t.css({left:e[0]+10+"px",top:e[1]-50+"px"});var o=u.map.forEachFeatureAtPixel(e,function(e,t){return t===s?e:null});if(o){var r=o.get("title");""!==r?(t.text(r),t.show()):t.hide()}else t.hide()}(u.map.getEventPixel(e.originalEvent))}function a(){$.getJSON(c.observations,function(e){e.observations.length<5e4?s=u.createObservationsFeatureLayer(e.observations):console.log("WARNING: too many observations to show")})}var i=o(2),l="/static/waarnemingkaart-data/",s=null;$.ajaxSetup({beforeSend:function(e){e.overrideMimeType&&e.overrideMimeType("application/json")}});var c=function(){var e=r("group"),t=r("family"),o=r("species");if(""==e&&""==t&&""==o)return null;console.log("group",e),console.log("family",t),console.log("species",o);var n=l,a=l;return e&&t?(n+=e+"/",a+=e+"/"):(n+=e+".json",a+="contours_"+e+".geojson"),t&&o&&""!==t&&""!==o?(n+=t+"/",a+=t+"/",n+=o+".json",a+="contours_"+o+".geojson"):t&&""!==t&&(n+=t+".json",a+="contours_"+t+".geojson"),{observations:n,contours:a}}(),u=i.createObservationMap();c&&u.addContourTileLayer(c.contours),document.getElementById("export-png").addEventListener("click",function(){var e=u.osmLayer.getOpacity();u.osmLayer.setOpacity(1),u.map.once("postcompose",function(e){var t=e.context.canvas;navigator.msSaveBlob?navigator.msSaveBlob(t.msToBlob(),"map.png"):t.toBlob(function(e){saveAs(e,"map.png")})}),u.map.renderSync(),u.osmLayer.setOpacity(e)}),$("#info").hide(),u.map.on("pointermove",n),u.map.on("moveend",function(e){var t=u.map.getView().getZoom()>11;t&&!s&&a(),s&&s.setVisible(t)})},function(e,t,o){function r(){return Object.create(a).ObservationMap()}var n=o(3),a={ObservationMap:function(){return this.osmLayer=null,this.map=this.createOpenLayersMap(),this.map.contourLayers=[],this},createOpenLayersMap:function(){console.log("createOpenLayersMap","BEGIN");var e=new ol.Map({target:"map"}),t=new ol.View({center:ol.proj.fromLonLat(["5.5","142.0"]),zoom:8,projection:"EPSG:3857"});e.setView(t);var o=new ol.source.OSM("OpenStreetMap");return o.setUrl("https://maps.wikimedia.org/osm-intl/{z}/{x}/{y}.png"),this.osmLayer=new ol.layer.Tile({source:o}),this.osmLayer.setOpacity(.7),e.addLayer(this.osmLayer),e.addControl(new ol.control.FullScreen),console.log("createOpenLayersMap","END"),e},createObservationsFeatureLayer:function(e){console.log("createObservationsFeatureLayer","BEGIN");var t=[];for(var o in e){var r=e[o],a=parseFloat(r.lat);a+=90;var i=[r.lon.toFixed(5),a.toFixed(5)],l=function(e,t){return new ol.Feature({geometry:new ol.geom.Point(ol.proj.fromLonLat(t)),title:e.title,number:e.number})}(r,i);t.push(l)}for(var s in t)t[s].setStyle(n.observationFeatureStyle);var c=new ol.source.Vector({features:t}),u=new ol.layer.Vector({source:c});return u.setZIndex(0),this.map.addLayer(u),console.log(t.length,"features created"),console.log("createObservationsFeatureLayer()","END"),u},addContourTileLayer:function(e){console.log("create contour layer for geojson_url",e);var t=function(e,t){if(t.geometry){var o=t.type,r=t.geometry;return 1===o?1===r.length?"Point":"MultiPoint":2===o?1===r.length?"LineString":"MultiLineString":3===o&&(1===r.length?"Polygon":"MultiPolygon"),{type:"Feature",geometry:{type:"MultiLineString",coordinates:r},properties:t.tags}}return t},o=new ol.proj.Projection({code:"TILE_PIXELS",units:"tile-pixels"}),r=this.map;return fetch(e).then(function(e){return e.json()}).then(function(e){function n(e,t){var o=e.get("stroke-width"),n=r.getView().getZoom(),a=o/3,i=(e.get("level-value"),1+e.get("level-index")),l=Math.pow(n,2)/400;return l*=i/2,i%3==1&&(l*=3),11===i&&(l*=1.5),new ol.style.Style({stroke:new ol.style.Stroke({color:e.get("stroke"),width:a*l})})}var a=geojsonvt(e,{extent:4096,debug:1,indexMaxPoints:5e5}),i=new ol.source.VectorTile({format:new ol.format.GeoJSON,tileGrid:ol.tilegrid.createXYZ(),tilePixelRatio:16,tileLoadFunction:function(e){var r=e.getFormat(),n=e.getTileCoord(),i=a.getTile(n[0],n[1],-n[2]-1),l=r.readFeatures(JSON.stringify({type:"FeatureCollection",features:i?i.features:[]},t));e.setLoader(function(){e.setFeatures(l),e.setProjection(o)})},url:"data:"}),l=new ol.layer.VectorTile({source:i,style:n,updateWhileInteracting:!1,updateWhileAnimating:!1,renderMode:"vector"});r.addLayer(l),l.setVisible(!0),r.contourLayers.push(l)})}};e.exports={createObservationMap:r}},function(e,t){function o(e,t){var o=.25*Math.sqrt(5e3/t),r=o;r<1&&(r=0),width=.3*r;var n=new ol.style.Circle({fill:new ol.style.Fill({color:"white"}),stroke:new ol.style.Stroke({color:"blue",width:width}),radius:r});return new ol.style.Style({image:n})}e.exports={observationFeatureStyle:o}}]);